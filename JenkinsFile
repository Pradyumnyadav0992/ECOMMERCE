pipeline{
    agent any
    environment {
        VERSION = ''
        DOCKER_USENAME = credentials('DOCKER_CREDENTIALS')
    }

    parameters {
        choice(name: "Version" , choices: ["A","B"], description: "Anything" )
        booleanParam(name: 'executeTest', defaultValue: true, description: "hi")
    }

    stages{

        stage("PULL") {
            steps {
                git branch: 'main', url: 'https://github.com/Pradyumnyadav0992/ECOMMERCE.git'
                script {
                    def version = sh(script: "git describe --tags --abbrev=0", returnStdout: true).trim()
                    env.VERSION = version
                    echo "Using version: ${env.VERSION}"
                }
            }
        }



        stage("File change List"){
        steps {
            script {
                def changedFiles = sh(script: "git diff --name-only HEAD~1 HEAD", returnStdout: true).trim()
                echo "Changed files:\n${changedFiles}"
            }
        }

        }

        stage("JTest"){
            steps {
                echo "Changed files:"
            }
        
        }

        stage("Build"){
                    steps {
                echo "Changed files:"
            }
        }

        stage("Image Scan"){
                        steps {
                echo "Changed files:"
            }
        }

        stage("Push"){

             steps {
                withCredentials([usernamePassword(credentialsId: 'DOCKER_CREDENTIALS', usernameVariable: 'USER', passwordVariable: 'PASSWD')]) {
                    echo "Pushing Docker image with user $USER"
                    // Example: sh "docker login -u $USER -p $PASSWD"
                }
            }
        }

        stage("Update Manifest"){
             steps {
                echo "Changed files:"
            }
        }
    }
}
